
<html><head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta content="text/javascript" http-equiv="content-script-type">
<title>org.dsource.descent.unittests.flute</title>
<link rel="stylesheet" type="text/css" href="candydoc/style.css">
<!--[if lt IE 7]><link rel="stylesheet" type="text/css" href="candydoc/ie56hack.css"><![endif]-->
<script language="JavaScript" src="candydoc/util.js" type="text/javascript"></script>
<script language="JavaScript" src="candydoc/tree.js" type="text/javascript"></script>
<script language="JavaScript" src="candydoc/explorer.js" type="text/javascript"></script>
</head><body>
<div id="tabarea"></div><div id="explorerclient"></div>
<div id="content"><script>explorer.initialize("org.dsource.descent.unittests.flute");</script>
	<table class="content">
		<tr><td id="docbody"><h1>org.dsource.descent.unittests.flute</h1><!-- Generated by Ddoc from ..\src\org\dsource\descent\unittests\flute.d -->
<b>Summary:</b><br>
Flute is an interactive tool for executing D unit tests. It is based on Thomas
 Kuehne's <a href="http://flectioned.kuehne.cn/#unittest">UnittestWalker</a>. Like
 UnittestWalker, it requires <a href="http://flectioned.kuehne.cn">Flectioned</a> to work
 correctly, and right now is only compatible with D version 1.x. It extends
 UnittestWalker by providing an interactive (stdin/stdout-based) way to find and
 execute unit tests.
<br><br>

 However, while 
<span class="currsymbol">flute</span>
<script>explorer.outline.addDecl('flute');</script>

 can be used interactively, it is mainly
 designed to be extended by automated testing tools, such as
 <a href="http://www.dsource.org/projects/descent">descent.unittest</a> or build tools,
 and hopefully be integrated into a project like CruiseControl, etc. It also allows
 for execution of tests one at a time or execution of selected tests, which makes
 test automation more versatile (especially if running all the tests takes a long
 time.) To be truly used effectively, 
<span class="currsymbol">flute</span>
<script>explorer.outline.addDecl('flute');</script>

 needs to be paired with a code analysis
 or other tool to identify/name unittests which is then executed by the fluted
 application. If all you want is to run all the unittests in the project,
 UnittestWalker is a better bet.

<br><br>
<b>Usage:</b><br>
Flute must be statically linked against an application, just like UnittestWalker.
 TODO - more here.

<br><br>
<b>Definitions:</b><br>
<ul>   <li>A "line" is any number of ASCII characters (that may contain CR, LF or a
        CRLF pair, although they will only do so if the host program uses
        them, for example in the text for an assert() statement) followed by a
        CRLF pair.</li>
    <li>A "prompt" is the characters "&gt; " (greater-than, space), following the end
        of a line, after which no more will be written to standard output. The
        program will read a single line from standard input (a line in this
        case is defined by the properties of the host system).</li></ul>

<br><br>
<b>Interface:</b><br>
The interface is well-defined. That is, while it is designed to be human-
 readable, it is fully specified and can hopefully be processed by automated
 testing tools. The interface may change between versions.
<br><br>

 When the program is executed, one or more lines containing version information
 (so far in an unspecified format) will be displayed, followed by a prompt. At
 this prompt, any of the following commands can be run: <ul>    <li><b>r [test signature]</b> -
        (A lowercase r, followed by a space, followed by the
        signature of a test). Will run the specified test and print the
        results to stdout. See "test signature specification" for the
        specification of what the test signatures will look like. See "test
        result specification" for a specification of what the results will
        look like. After running the test, a prompt will be displayed for
        entry of another command.</li>
     <li><b>l</b> -
        (A lowercase l alone on a line). Will list the signatures of all the
        tests in the application, followed by a prompt for a new command. The tests
        will be listed one signature per line. The order is undefined, and since
        they're stored in a hash, they will probably be quite out of order. Also,
        this list will generally be really long (since there are standard library
        and Flectioned tests in there), and none will be fun to type, so there's
        another reason to use an invoker.</li>
     <li><b>a</b> -
        (An a alone on a line). Will execute all the tests in the
        application. For each test, it will write a line containing "Running: "
        (without the quotes), then the signature of the test being run on a
        line. Then it will write the results of a test. After running all the
        tests, a line containing "SUMMARY: " will be written, then all of the following
        lines&#58 "PASSED: #/#", "FAILED: #/#", "ERROR: #/#", each preceded by
        three spaces, where the first number sign in a line is replaced by the number
        of tests that met that condition, and the second in each line is replaced
        by the total number of executed tests. Any tests that caused an internal
        error will not be reported in any of the three categories, nor will they be
        included in the total. There will be a blank line between each test.</li>
     <li><b>x</b> -
        (An x alone on a line). Will exit the program.</li>
 </ul>

<br><br>
<b>Test Signature Specification:</b><br>
A test signature is a way to uniquely identify a unittest in an application.
 Although linker symbols do this, they are not availible to a code-analysis
 front-end. Thus, a signature form is needed that can be generated by code
 analysis, easily translated to and from linker symbols, and is (generally) human-
 readable.
<br><br>

 A test signature consists of the fully-qualified name of the test's location,
 followed by a period, followed by the number of the test in that location in the
 lexical order the test appears (0-based). For example if you have:
<pre class="d_code"> <font color=blue>module</font> foo.bar;

 <font color=blue>unittest</font> { <font color=green>/+ Test 1 +/</font> }

 <font color=blue>class</font> Baz {
     <font color=blue>unittest</font> { <font color=green>/+ Test 2 +/</font> }
 }

 <font color=blue>unittest</font> { <font color=green>/+ Test 3 +/</font> }
</pre>
 there will be three tests: <ul>   <li>Test 1 is <b>foo.bar.0</b></li>
    <li>Test 2 is <b>foo.bar.Baz.0</b></li>
    <li>Test 3 is <b>foo.bar.1</b></li>
 </ul>

<br><br>
<b>Test Result Specification:</b><br>
After a test is run, there are four possible results: <ul>   <li>The test could succeed, in which case a line containing "<b>PASSED</b>" will be
       printed on a line.</li>
    <li>The test could fail an assertion. A line containing "<b>FAILED</b>" will be printed,
       followed by the stack trace of the exception.</li>
    <li>The test could throw an exception. A line containing "<b>ERROR</b>" will be printed,
       followed by the stack trace of the exception. The main rationale for
       treating test failures differently than exceptions is to allow automated
       tools to track failures vs. error conditions. However, the tool can't
       differentiate between assertions failed in the tests and assertions failed
       in the main program body, so a "<b>FAILED</b>" message can mean either.</li>
    <li>An internal error could occur with the test runner (for example, the test is
       not found). In this case, a human-readable message that does not begin with
       "<b>PASSED</b>", "<b>FAILED</b>" or "<b>ERROR</b>" will be printed on a single line.
       If the test is not found, the message will be "Test [test signature] not found",
       where "[test signature]" will be replaced with the signature of the test.
       Other error messages may appear and are unspecified.</li>
 </ul>

<br><br>
<b>Stack Trace Specification:</b><br>
The test runner has support for Flectioned's TracedException, but will work
 correctly even if the thrown exception is not a TracedException. The stack trace
 will begin with a line containing the name of the thrown exception. If the
 exception has a message, this will be followed by ": " and then the exception
 message.
<br><br>

 If the exception is a subclass of TracedException, this will be followed by the
 actual stack trace of the exception. Each line of the stack trace will begin with
 three spaces, which will allow stack traces to be easily visually parsed
 from the surrounding information and dealt with in automated tools.
<br><br>

 Each line of the stack trace represents a stack frame that was executing when the
 exception was thrown. The stack frames will be reported in reverse order (the
 "unwinding" of the stack). TODO - finish this.

<br><br>
<b>Named Tests:</b><br>
Right now, there's no way to name tests. This is a planned feature, however the
 only ways I can think of doing it seem mighty hackish (a macro mixing in some
 ASM at the top of the test and playing with the function pointer from there is
 the best option I can think of). If anyone has any ideas, please e-mail me.

<br><br>
<b>Limitations:</b><br>
<ul>   <li>No test naming</li>
    <li>Only works with D 1.x</li>
    <li>Requires Flectioned (not likely to change)</li>
 </ul>

<br><br>
<font color=red>BUGS:</font><br>
If a class is inside a function, unittests in that class won't work. Keep this in
 mind when generating signatures in code analysis tools. For example, if you have:
<pre class="d_code"> <font color=blue>module</font> foo.bar;

 <font color=blue>unittest</font> { <font color=green>/+ Test 1 +/</font> }

 <font color=blue>void</font> baz() {
     <font color=blue>class</font> Quux {
         <font color=blue>unittest</font> { <font color=green>/+ Test 2 +/</font> }
     }
 }

 <font color=blue>unittest</font> { <font color=green>/+ Test 3 +/</font> }
</pre>
 there will be two tests: <ul>   <li>Test 1 is <b>foo.bar.0</b></li>
    <li>Test 3 is <b>foo.bar.1</b></li>
 </ul>
 The middle test is inaccesible via 
<span class="currsymbol">flute</span>
<script>explorer.outline.addDecl('flute');</script>

. This applies to unittests in anonymous
 classes, too. I hope to fix this in a future version.

<br><br>
<b>Authors:</b><br>
Robert Fraser (fraserofthenight@gmail.com)

<br><br>
<b>Version:</b><br>
Almost 0.1

<br><br>
<b>License:</b><br>
Copyright (c) 2007 Robert Fraser (fraserofthenight@gmail.com)


<br><br>

 All rights reserved.
<br><br>

 Redistribution and use in source and binary forms, with or without
 modification, is permitted provided that the following conditions are met:
<br><br>

 1. Redistributions of source code must retain the above copyright notice,
    this list of conditions and the following disclaimer.
<br><br>

 2. Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the
    documentation and/or other materials provided with the distribution.
<br><br>

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 POSSIBILITY OF SUCH DAMAGE.
 
<br><br>


<script>explorer.outline.incSymbolLevel();</script>
<dl>
<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const char[] 
<span class="currsymbol">CRLF</span>
<script>explorer.outline.addDecl('CRLF');</script>

;
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>A carriage-return/line-feed pair
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const char[] 
<span class="currsymbol">marker</span>
<script>explorer.outline.addDecl('marker');</script>

;
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>A Flectioned 
<span class="currsymbol">marker</span>
<script>explorer.outline.addDecl('marker');</script>

 indicating that it's a unittest
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">enum 
<span class="currsymbol">TestResult</span>
<script>explorer.outline.addDecl('TestResult');</script>

;
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>An enum containing the result of running a test
 
<br><br>


<script>explorer.outline.incSymbolLevel();</script>
<dl>
<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">
<span class="currsymbol">PASSED</span>
<script>explorer.outline.addDecl('PASSED');</script>

</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>The test passed
	 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">
<span class="currsymbol">FAILED</span>
<script>explorer.outline.addDecl('FAILED');</script>

</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>The test failed with an AssertionError being thrown
	 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">
<span class="currsymbol">ERROR</span>
<script>explorer.outline.addDecl('ERROR');</script>

</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>The test failed with another exception type being thrown
	 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">
<span class="currsymbol">INTERNAL_ERROR</span>
<script>explorer.outline.addDecl('INTERNAL_ERROR');</script>

</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>There was an internal error in flute running the test
	 
<br><br>

</dd>
</dl>
<script>explorer.outline.decSymbolLevel();</script>


</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">Function[char[]] 
<span class="currsymbol">tests</span>
<script>explorer.outline.addDecl('tests');</script>

;
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>A map of test signatures to Flectioned function objects
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">fluteMain</span>
<script>explorer.outline.addDecl('fluteMain');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Main flute entry point. This will be called during static construction, and
 should, in turn, begin execution of the program.
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">printVersionInfo</span>
<script>explorer.outline.addDecl('printVersionInfo');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Prints information about the current version.
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">fluteExit</span>
<script>explorer.outline.addDecl('fluteExit');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Exits the program gracefully (i.e. runs module destructors, kills the garbage
 collector, etc.). THis function doesn't return.
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">bool 
<span class="currsymbol">commandLoop</span>
<script>explorer.outline.addDecl('commandLoop');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Runs the main flute command loop. Prints the prompt, reads user entry of a
 command, and invokes the specified command.
<br><br>
<b>Returns:</b><br>
<b>false</b> if the user entered the exit command, <b>true</b> otherwise.
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">TestResult 
<span class="currsymbol">runTest</span>
<script>explorer.outline.addDecl('runTest');</script>

(char[] <span class="funcparam">sig</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Runs a single test, given by the signature, and outputs the results to stdout as
 PASSED, FAILED or ERROR, or will output the associated internal error message if
 it was one of those.
<br><br>
<b>Params:</b><br>
<table><tr>
<td nowrap valign="top" style="padding-right: 8px">char[] <span class="funcparam">sig</span></td>

               
<td>the signature of the test</td></tr>
</table><br>
<b>Returns:</b><br>
The result of running the test
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">printStackTrace</span>
<script>explorer.outline.addDecl('printStackTrace');</script>

(Exception <span class="funcparam">e</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Prints the stack trace for the exception in the specified format.
<br><br>
<b>Params:</b><br>
<table><tr>
<td nowrap valign="top" style="padding-right: 8px">Exception <span class="funcparam">e</span></td>

               
<td>The exception to print the stack trace for</td></tr>
</table><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">Exception 
<span class="currsymbol">run</span>
<script>explorer.outline.addDecl('run');</script>

(Function <span class="funcparam">test</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Runs the specified <span class="funcparam">test</span>, catches any exceptions and returns those exceptions.
 Returns <b>null</b> if no exceptions were thrown.
<br><br>
<b>Params:</b><br>
<table><tr>
<td nowrap valign="top" style="padding-right: 8px">Function <span class="funcparam">test</span></td>

               
<td>The unit <span class="funcparam">test</span> Function object to 
<span class="currsymbol">run</span>
<script>explorer.outline.addDecl('run');</script>

</td></tr>
</table><br>
<b>Returns:</b><br>
Any exception that was thrown, or <b>null</b> if none were.
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">init</span>
<script>explorer.outline.addDecl('init');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Initialzes the tests hash by generating signatures for every unittest function.
 
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">runAllTests</span>
<script>explorer.outline.addDecl('runAllTests');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Runs all the tests in the application
 
<br><br>

</dd>
</dl>
<script>explorer.outline.decSymbolLevel();</script>


</td></tr>
		<tr><td id="docfooter">
			Page was generated with
			<img src="candydoc/img/candydoc.gif" style="vertical-align:middle; position:relative; top:-1px">
			on Wed Nov 28 12:53:04 2007

		</td></tr>
	</table>
</div>
<script>
	explorer.packageExplorer.addModule("org.source.descent.unittests.flute");</script>
</body></html>


